import { createSpinner } from "nanospinner";
import { loadConfig } from "../utils/configLoader";
import { logger } from "../utils/logger";
import {
  analyzeProject,
  ProjectStats,
  AnalysisOptions,
} from "../utils/projectAnalyzer";

export const analyzeProjectCommand = async (options: AnalysisOptions) => {
  const spinner = createSpinner("Analyzing project...").start();

  try {
    const config = loadConfig();

    // Analiz yap
    const stats = await analyzeProject(config, options);

    if (options.json) {
      // JSON formatÄ±nda Ã§Ä±ktÄ± - HTML ile tutarlÄ± hale getir
      const enhancedStats = {
        ...stats,
        metadata: {
          generatedAt: new Date().toISOString(),
          tool: "Kedy CLI",
          version: "1.0.0",
          disclaimer:
            "This report was generated by Kedy CLI tool. Analysis results may contain errors or inaccuracies. Use at your own risk.",
        },
        summary: {
          projectOverview: {
            totalFiles: stats.totalFiles,
            totalLines: stats.totalLines,
            totalSizeKB: (stats.totalSize / 1024).toFixed(2),
          },
          fileDistribution: {
            screens: stats.screens.length,
            components: stats.components.length,
            hooks: stats.hooks.length,
            utils: stats.utils.length,
            others: stats.others.length,
          },
          codeQuality: {
            highComplexityComponents: stats.components.filter(
              (f) => f.complexity > 10
            ).length,
            largeScreens: stats.screens.filter((f) => f.lines > 200).length,
            unusedCodePercentage: (
              (stats.unusedFiles.length / stats.totalFiles) *
              100
            ).toFixed(1),
          },
        },
        projectStructure: generateProjectStructure(stats),
      };

      console.log(JSON.stringify(enhancedStats, null, 2));
      spinner.success({ text: "Project analysis completed!" });
      return;
    }

    if (options.html) {
      // HTML raporu oluÅŸtur (basit versiyon)
      generateHTMLReport(stats);
      spinner.success({ text: "HTML report generated!" });
      return;
    }

    // Konsol raporu
    displayConsoleReport(stats, options);

    spinner.success({ text: "Project analysis completed!" });
  } catch (error: any) {
    spinner.error({ text: `Failed to analyze project: ${error.message}` });
    logger.error(error);
  }
};

// Konsol raporu gÃ¶ster
const displayConsoleReport = (
  stats: ProjectStats,
  options: AnalysisOptions
) => {
  console.log("\nğŸ“Š Project Analysis Report");
  console.log("=".repeat(50));

  // Proje genel bakÄ±ÅŸ
  console.log("\nğŸ—ï¸  Project Overview:");
  console.log(`   ğŸ“ Total files: ${stats.totalFiles}`);
  console.log(`   ğŸ“ Total lines: ${stats.totalLines.toLocaleString()}`);
  console.log(`   ğŸ’¾ Total size: ${(stats.totalSize / 1024).toFixed(2)} KB`);

  // Kategorilere gÃ¶re daÄŸÄ±lÄ±m
  console.log("\nğŸ“‚ File Distribution:");
  console.log(`   ğŸ“± Screens: ${stats.screens.length}`);
  console.log(`   ğŸ§© Components: ${stats.components.length}`);
  console.log(`   ğŸª Hooks: ${stats.hooks.length}`);
  console.log(`   ğŸ› ï¸  Utils: ${stats.utils.length}`);
  console.log(`   ğŸ“„ Others: ${stats.others.length}`);

  if (options.detailed) {
    // DetaylÄ± screen analizi
    if (stats.screens.length > 0) {
      console.log("\nğŸ“± Screen Analysis:");
      const sortedScreens = [...stats.screens].sort(
        (a, b) => b.lines - a.lines
      );
      sortedScreens.slice(0, 5).forEach((screen) => {
        const sizeKB = (screen.size / 1024).toFixed(2);
        console.log(
          `   ğŸ“„ ${screen.relativePath} (${screen.lines} lines, ${sizeKB} KB, complexity: ${screen.complexity})`
        );
      });
    }

    // DetaylÄ± component analizi
    if (stats.components.length > 0) {
      console.log("\nğŸ§© Component Analysis:");
      const sortedComponents = [...stats.components].sort(
        (a, b) => b.complexity - a.complexity
      );
      sortedComponents.slice(0, 5).forEach((component) => {
        const sizeKB = (component.size / 1024).toFixed(2);
        console.log(
          `   ğŸ“„ ${component.relativePath} (${component.lines} lines, ${sizeKB} KB, complexity: ${component.complexity})`
        );
      });
    }

    // KullanÄ±lmayan dosyalar
    if (stats.unusedFiles.length > 0) {
      console.log("\nğŸ—‘ï¸  Unused Files:");
      stats.unusedFiles.forEach((file) => {
        console.log(`   ğŸ“„ ${file}`);
      });
    }
  }

  // Code quality analizi
  console.log("\nğŸ› ï¸  Code Quality:");
  const highComplexityComponents = stats.components.filter(
    (f) => f.complexity > 10
  );
  const largeScreens = stats.screens.filter((f) => f.lines > 200);
  const unusedPercentage = (stats.unusedFiles.length / stats.totalFiles) * 100;

  console.log(
    `   âš ï¸  High complexity components: ${highComplexityComponents.length}`
  );
  console.log(`   ğŸ“ Large screens (>200 lines): ${largeScreens.length}`);
  console.log(`   ğŸ—‘ï¸  Unused code: ${unusedPercentage.toFixed(1)}%`);

  // Ã–neriler
  if (stats.recommendations.length > 0) {
    console.log("\nğŸ’¡ Recommendations:");
    stats.recommendations.forEach((rec, index) => {
      console.log(`   ${index + 1}. ${rec}`);
    });
  }

  // Architecture Analizi
  if (stats.architecture) {
    console.log("\nğŸ—ï¸ Architecture Analysis:");
    console.log(
      `   ğŸ“ Folder Structure: ${stats.architecture.folderStructure.score}/100`
    );
    console.log(
      `   ğŸ“ Naming Conventions: ${stats.architecture.namingConventions.score}/100`
    );
    console.log(
      `   ğŸ§© Component Hierarchy: Max depth ${stats.architecture.componentHierarchy.maxDepth}`
    );
    console.log(
      `   ğŸ”„ State Management: ${
        stats.architecture.stateManagement.patterns.join(", ") ||
        "None detected"
      }`
    );

    if (stats.architecture.folderStructure.issues.length > 0) {
      console.log("   âš ï¸ Folder Issues:");
      stats.architecture.folderStructure.issues
        .slice(0, 3)
        .forEach((issue) => console.log(`      â€¢ ${issue}`));
    }
  }

  // Testing Analizi
  if (stats.testing) {
    console.log("\nğŸ§ª Testing Analysis:");
    console.log(
      `   ğŸ“Š Coverage: ${stats.testing.coverage.coveragePercentage}% (${stats.testing.coverage.testedFiles}/${stats.testing.coverage.totalFiles} files)`
    );
    console.log(`   ğŸ¯ Test Quality: ${stats.testing.testQuality.score}/100`);
    console.log(
      `   ğŸ› ï¸ Frameworks: ${
        stats.testing.testPatterns.frameworks.join(", ") || "None detected"
      }`
    );

    if (stats.testing.coverage.missingTests.length > 0) {
      console.log("   âŒ Missing Tests:");
      stats.testing.coverage.missingTests
        .slice(0, 3)
        .forEach((test) => console.log(`      â€¢ ${test}`));
    }
  }

  // Security Analizi
  if (stats.security) {
    console.log("\nğŸ”’ Security Analysis:");
    console.log(
      `   ğŸ“¦ Vulnerable Packages: ${stats.security.dependencies.vulnerablePackages.length}`
    );
    console.log(
      `   ğŸ”‘ Hardcoded Secrets: ${stats.security.codeSecurity.hardcodedSecrets.length}`
    );
    console.log(
      `   ğŸŒ API Endpoints: ${stats.security.apiSecurity.endpoints.length}`
    );
    console.log(
      `   âœ… Input Validation: ${stats.security.inputValidation.missingValidation.length} missing`
    );

    if (stats.security.codeSecurity.hardcodedSecrets.length > 0) {
      console.log("   âš ï¸ Security Issues:");
      stats.security.codeSecurity.hardcodedSecrets
        .slice(0, 2)
        .forEach((secret) => console.log(`      â€¢ ${secret}`));
    }
  }
};

// HTML raporu oluÅŸtur
const generateHTMLReport = (stats: ProjectStats) => {
  const html = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Analysis Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        .section { margin: 20px 0; padding: 15px; border-left: 4px solid #007AFF; background: #f8f9fa; }
        .metric { display: inline-block; margin: 10px; padding: 10px; background: #e9ecef; border-radius: 4px; }
        .score { font-size: 24px; font-weight: bold; }
        .excellent { color: #28a745; }
        .good { color: #ffc107; }
        .fair { color: #fd7e14; }
        .poor { color: #dc3545; }
        .file-list { list-style: none; padding: 0; }
        .file-list li { padding: 5px 0; border-bottom: 1px solid #eee; }
        .recommendations { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 4px; }
        .analysis-section { margin: 25px 0; padding: 20px; border-left: 4px solid #28a745; background: #f8fff8; }
        .analysis-section h3 { color: #28a745; margin-top: 0; }
        .sub-metric { margin: 8px 0; padding: 8px; background: #e8f5e8; border-radius: 4px; }
        .warning { color: #dc3545; }
        .success { color: #28a745; }
        .info { color: #007AFF; }
        .error-section { margin: 15px 0; padding: 12px; background: #fff5f5; border-left: 4px solid #dc3545; border-radius: 4px; }
        .warning-section { margin: 15px 0; padding: 12px; background: #fffbf0; border-left: 4px solid #ffc107; border-radius: 4px; }
        .info-section { margin: 15px 0; padding: 12px; background: #f0f8ff; border-left: 4px solid #007AFF; border-radius: 4px; }
        .error-title { color: #dc3545; font-weight: bold; margin-bottom: 8px; }
        .warning-title { color: #ffc107; font-weight: bold; margin-bottom: 8px; }
        .info-title { color: #007AFF; font-weight: bold; margin-bottom: 8px; }
        .tree-structure { font-family: 'Courier New', monospace; font-size: 15px; line-height: 1.6; background: #f8f9fa; padding: 15px; border-radius: 6px; border: 1px solid #e9ecef; }
        .tree-folder { color: #007AFF; font-weight: bold; margin: 8px 0 4px 0; font-size: 16px; }
        .tree-file { color: #333; margin: 2px 0; font-weight: 600; }
        .tree-screen { color: #28a745; margin: 2px 0; font-weight: 600; }
        .tree-component { color: #ffc107; margin: 2px 0; font-weight: 600; }
        .tree-hook { color: #fd7e14; margin: 2px 0; font-weight: 600; }
        .tree-util { color: #6f42c1; margin: 2px 0; font-weight: 600; }
        .tree-unused { color: #dc3545; margin: 2px 0; font-weight: 600; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Project Analysis Report</h1>
        
        <!-- Project Overview -->
        <div class="analysis-section">
            <h3>ğŸ—ï¸ Project Overview</h3>
            <div class="sub-metric">ğŸ“ Total files: <strong>${
              stats.totalFiles
            }</strong></div>
            <div class="sub-metric">ğŸ“ Total lines: <strong>${stats.totalLines.toLocaleString()}</strong></div>
            <div class="sub-metric">ğŸ’¾ Total size: <strong>${(
              stats.totalSize / 1024
            ).toFixed(2)} KB</strong></div>
        </div>
        
        <!-- File Distribution -->
        <div class="analysis-section">
            <h3>ğŸ“‚ File Distribution</h3>
            <div class="sub-metric">ğŸ“± Screens: <strong>${
              stats.screens.length
            }</strong></div>
            <div class="sub-metric">ğŸ§© Components: <strong>${
              stats.components.length
            }</strong></div>
            <div class="sub-metric">ğŸª Hooks: <strong>${
              stats.hooks.length
            }</strong></div>
            <div class="sub-metric">ğŸ› ï¸ Utils: <strong>${
              stats.utils.length
            }</strong></div>
            <div class="sub-metric">ğŸ“„ Others: <strong>${
              stats.others.length
            }</strong></div>
            
            <div class="info-section">
                <div class="info-title">ğŸŒ³ Project Structure:</div>
                <div class="tree-structure">${generateProjectTree(stats)}</div>
            </div>
        </div>
        
        <!-- Code Quality -->
        <div class="analysis-section">
            <h3>ğŸ› ï¸ Code Quality</h3>
            <div class="sub-metric">âš ï¸ High complexity components: <strong>${
              stats.components.filter((f) => f.complexity > 10).length
            }</strong></div>
            <div class="sub-metric">ğŸ“ Large screens (>200 lines): <strong>${
              stats.screens.filter((f) => f.lines > 200).length
            }</strong></div>
            <div class="sub-metric">ğŸ—‘ï¸ Unused code: <strong>${(
              (stats.unusedFiles.length / stats.totalFiles) *
              100
            ).toFixed(1)}%</strong></div>
            ${
              stats.components.filter((f) => f.complexity > 10).length > 0
                ? `
            <div class="warning-section">
                <div class="warning-title">âš ï¸ High Complexity Components:</div>
                <ul class="file-list">${stats.components
                  .filter((f) => f.complexity > 10)
                  .map(
                    (comp) =>
                      `<li>â€¢ ${comp.relativePath} (complexity: ${comp.complexity})</li>`
                  )
                  .join("")}</ul>
            </div>`
                : ""
            }
            ${
              stats.screens.filter((f) => f.lines > 200).length > 0
                ? `
            <div class="warning-section">
                <div class="warning-title">âš ï¸ Large Screens:</div>
                <ul class="file-list">${stats.screens
                  .filter((f) => f.lines > 200)
                  .map(
                    (screen) =>
                      `<li>â€¢ ${screen.relativePath} (${screen.lines} lines)</li>`
                  )
                  .join("")}</ul>
            </div>`
                : ""
            }
        </div>
        

        
                
        
        <!-- Architecture Analysis -->
        <div class="analysis-section">
            <h3>ğŸ—ï¸ Architecture Analysis</h3>
            <div class="sub-metric">ğŸ“ Folder Structure: <strong>${
              stats.architecture?.folderStructure?.score || 0
            }/100</strong></div>
            <div class="sub-metric">ğŸ“ Naming Conventions: <strong>${
              stats.architecture?.namingConventions?.score || 0
            }/100</strong></div>
            <div class="sub-metric">ğŸ§© Component Hierarchy: Max depth <strong>${
              stats.architecture?.componentHierarchy?.maxDepth || 0
            }</strong></div>
            <div class="sub-metric">ğŸ”„ State Management: <strong>${
              stats.architecture?.stateManagement?.patterns?.join(", ") ||
              "None detected"
            }</strong></div>
            ${
              stats.architecture?.folderStructure?.issues &&
              stats.architecture.folderStructure.issues.length > 0
                ? `
            <div class="warning-section">
                <div class="warning-title">âš ï¸ Folder Structure Issues:</div>
                <ul class="file-list">${stats.architecture.folderStructure.issues
                  .map((issue: string) => `<li>â€¢ ${issue}</li>`)
                  .join("")}</ul>
            </div>`
                : ""
            }
            ${
              stats.architecture?.namingConventions?.violations &&
              stats.architecture.namingConventions.violations.length > 0
                ? `
            <div class="warning-section">
                <div class="warning-title">âš ï¸ Naming Convention Violations:</div>
                <ul class="file-list">${stats.architecture.namingConventions.violations
                  .map((violation: string) => `<li>â€¢ ${violation}</li>`)
                  .join("")}</ul>
            </div>`
                : ""
            }
            ${
              stats.architecture?.folderStructure?.recommendations &&
              stats.architecture.folderStructure.recommendations.length > 0
                ? `
            <div class="recommendations">
                <h4>Architecture Recommendations:</h4>
                <ul>${stats.architecture.folderStructure.recommendations
                  .map((rec: string) => `<li>${rec}</li>`)
                  .join("")}</ul>
            </div>`
                : ""
            }
        </div>
        
                <!-- Testing Analysis -->
        <div class="analysis-section">
            <h3>ğŸ§ª Testing Analysis</h3>
            <div class="sub-metric">ğŸ“Š Coverage: <strong>${
              stats.testing?.coverage?.coveragePercentage || 0
            }%</strong> (${stats.testing?.coverage?.testedFiles || 0}/${
    stats.testing?.coverage?.totalFiles || 0
  } files)</div>
            <div class="sub-metric">ğŸ¯ Test Quality: <strong>${
              stats.testing?.testQuality?.score || 0
            }/100</strong></div>
            <div class="sub-metric">ğŸ› ï¸ Frameworks: <strong>${
              stats.testing?.testPatterns?.frameworks?.join(", ") ||
              "None detected"
            }</strong></div>
            ${
              stats.testing?.coverage?.missingTests &&
              stats.testing.coverage.missingTests.length > 0
                ? `
            <div class="warning-section">
                <div class="warning-title">âš ï¸ Missing Tests:</div>
                <ul class="file-list">${stats.testing.coverage.missingTests
                  .map((test: string) => `<li>â€¢ ${test}</li>`)
                  .join("")}</ul>
            </div>`
                : ""
            }
            ${
              stats.testing?.coverage?.recommendations &&
              stats.testing.coverage.recommendations.length > 0
                ? `
            <div class="recommendations">
                <h4>Testing Recommendations:</h4>
                <ul>${stats.testing.coverage.recommendations
                  .map((rec: string) => `<li>${rec}</li>`)
                  .join("")}</ul>
            </div>`
                : ""
            }
        </div>
        
        <!-- Security Analysis -->
        <div class="analysis-section">
            <h3>ğŸ”’ Security Analysis</h3>
            <div class="sub-metric">ğŸ“¦ Vulnerable Packages: <strong>${
              stats.security?.dependencies?.vulnerablePackages?.length || 0
            }</strong></div>
            <div class="sub-metric">ğŸ”‘ Hardcoded Secrets: <strong>${
              stats.security?.codeSecurity?.hardcodedSecrets?.length || 0
            }</strong></div>
            <div class="sub-metric">ğŸŒ API Endpoints: <strong>${
              stats.security?.apiSecurity?.endpoints?.length || 0
            }</strong></div>
            <div class="sub-metric">âœ… Input Validation: <strong>${
              stats.security?.inputValidation?.missingValidation?.length || 0
            }</strong> missing</div>
            ${
              stats.security?.dependencies?.vulnerablePackages &&
              stats.security.dependencies.vulnerablePackages.length > 0
                ? `
            <div class="error-section">
                <div class="error-title">âŒ Vulnerable Packages:</div>
                <ul class="file-list">${stats.security.dependencies.vulnerablePackages
                  .map((pkg: string) => `<li>â€¢ ${pkg}</li>`)
                  .join("")}</ul>
            </div>`
                : ""
            }
            ${
              stats.security?.codeSecurity?.hardcodedSecrets &&
              stats.security.codeSecurity.hardcodedSecrets.length > 0
                ? `
            <div class="error-section">
                <div class="error-title">âŒ Hardcoded Secrets:</div>
                <ul class="file-list">${stats.security.codeSecurity.hardcodedSecrets
                  .map((secret: string) => `<li>â€¢ ${secret}</li>`)
                  .join("")}</ul>
            </div>`
                : ""
            }
            ${
              stats.security?.apiSecurity?.issues &&
              stats.security.apiSecurity.issues.length > 0
                ? `
            <div class="error-section">
                <div class="error-title">âŒ API Security Issues:</div>
                <ul class="file-list">${stats.security.apiSecurity.issues
                  .map((issue: string) => `<li>â€¢ ${issue}</li>`)
                  .join("")}</ul>
            </div>`
                : ""
            }
            ${
              stats.security?.dependencies?.recommendations &&
              stats.security.dependencies.recommendations.length > 0
                ? `
            <div class="recommendations">
                <h4>Security Recommendations:</h4>
                <ul>${stats.security.dependencies.recommendations
                  .map((rec: string) => `<li>${rec}</li>`)
                  .join("")}</ul>
            </div>`
                : ""
            }
        </div>
        

        
        ${
          stats.recommendations.length > 0
            ? `
        <!-- General Recommendations -->
        <div class="analysis-section">
            <h3>ğŸ’¡ General Recommendations</h3>
            <ul class="file-list">${stats.recommendations
              .map((rec) => `<li>â€¢ ${rec}</li>`)
              .join("")}</ul>
        </div>`
            : ""
        }
        
        ${
          stats.unusedFiles.length > 0
            ? `
        <!-- Unused Files -->
        <div class="info-section">
            <div class="info-title">ğŸ—‘ï¸ Unused Files</div>
            <ul class="file-list">${stats.unusedFiles
              .map((file) => `<li>ğŸ“„ ${file}</li>`)
              .join("")}</ul>
        </div>`
            : ""
        }
        
        <!-- Disclaimer -->
        <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-top: 2px solid #e9ecef; text-align: center; color: #6c757d; font-size: 12px; font-style: italic;">
            <p>âš ï¸ This report was generated by Kedy CLI tool. Analysis results may contain errors or inaccuracies. Use at your own risk.</p>
            <p>ğŸ“„ Generated on: ${new Date().toLocaleString()}</p>
        </div>
    </div>
</body>
</html>`;

  const fs = require("fs");
  fs.writeFileSync("project-analysis-report.html", html);
  console.log("ğŸ“„ HTML report saved as: project-analysis-report.html");
};

// Skor sÄ±nÄ±fÄ±nÄ± belirle
const getScoreClass = (score: number): string => {
  if (score >= 80) return "excellent";
  if (score >= 60) return "good";
  if (score >= 40) return "fair";
  return "poor";
};

// Skor aÃ§Ä±klamasÄ±nÄ± belirle
const getScoreDescription = (score: number): string => {
  if (score >= 80) return "Your project is well-optimized!";
  if (score >= 60) return "Some improvements can be made.";
  if (score >= 40) return "Consider implementing the recommendations.";
  return "Significant improvements needed.";
};

// JSON iÃ§in proje yapÄ±sÄ± oluÅŸtur
const generateProjectStructure = (stats: ProjectStats): any => {
  const allFiles = [
    ...stats.screens,
    ...stats.components,
    ...stats.hooks,
    ...stats.utils,
    ...stats.others,
  ];

  // DosyalarÄ± klasÃ¶rlere gÃ¶re grupla
  const folderStructure: { [key: string]: any[] } = {};

  allFiles.forEach((file) => {
    const pathParts = file.relativePath.split("/");
    const folder = pathParts.slice(0, -1).join("/");
    const fileName = pathParts[pathParts.length - 1];

    if (!folderStructure[folder]) {
      folderStructure[folder] = [];
    }

    folderStructure[folder].push({
      name: fileName,
      type: file.type,
      isUnused: stats.unusedFiles.includes(file.relativePath),
      size: file.size,
      lines: file.lines,
      complexity: file.complexity,
      relativePath: file.relativePath,
    });
  });

  // KlasÃ¶rleri sÄ±rala ve JSON formatÄ±nda dÃ¶ndÃ¼r
  const sortedFolders = Object.keys(folderStructure).sort();
  const structure: { [key: string]: any[] } = {};

  sortedFolders.forEach((folder) => {
    const sortedFiles = folderStructure[folder].sort((a, b) =>
      a.name.localeCompare(b.name)
    );
    structure[folder] = sortedFiles;
  });

  return structure;
};

// HTML iÃ§in proje aÄŸacÄ± oluÅŸtur
const generateProjectTree = (stats: ProjectStats): string => {
  const allFiles = [
    ...stats.screens,
    ...stats.components,
    ...stats.hooks,
    ...stats.utils,
    ...stats.others,
  ];

  // DosyalarÄ± klasÃ¶rlere gÃ¶re grupla
  const folderStructure: { [key: string]: any[] } = {};

  allFiles.forEach((file) => {
    const pathParts = file.relativePath.split("/");
    const folder = pathParts.slice(0, -1).join("/");
    const fileName = pathParts[pathParts.length - 1];

    if (!folderStructure[folder]) {
      folderStructure[folder] = [];
    }

    folderStructure[folder].push({
      name: fileName,
      type: file.type,
      isUnused: stats.unusedFiles.includes(file.relativePath),
    });
  });

  let tree = "";

  // Ana klasÃ¶rleri sÄ±rala
  const sortedFolders = Object.keys(folderStructure).sort();

  sortedFolders.forEach((folder, folderIndex) => {
    // KlasÃ¶r adÄ±nÄ± gÃ¶ster
    tree += `<div class="tree-folder">ğŸ“ ${folder}/</div>`;

    // KlasÃ¶r iÃ§indeki dosyalarÄ± sÄ±rala
    const sortedFiles = folderStructure[folder].sort((a, b) =>
      a.name.localeCompare(b.name)
    );

    sortedFiles.forEach((file, fileIndex) => {
      const isLastFile = fileIndex === sortedFiles.length - 1;

      // Tree Ã§izgileri - daha basit ve temiz
      const connector = isLastFile ? "â””â”€â”€ " : "â”œâ”€â”€ ";

      // Dosya tÃ¼rÃ¼ne gÃ¶re icon ve renk sÄ±nÄ±fÄ±
      let icon = "ğŸ“„";
      let colorClass = "tree-file";

      switch (file.type) {
        case "screen":
          icon = "ğŸ“±";
          colorClass = "tree-screen";
          break;
        case "component":
          icon = "ğŸ§©";
          colorClass = "tree-component";
          break;
        case "hook":
          icon = "ğŸª";
          colorClass = "tree-hook";
          break;
        case "util":
          icon = "ğŸ› ï¸";
          colorClass = "tree-util";
          break;
        default:
          icon = "ğŸ“„";
          colorClass = "tree-file";
      }

      // Unused dosyalar iÃ§in sadece renk deÄŸiÅŸikliÄŸi (Ã¼stÃ¼ Ã§izili deÄŸil)
      if (file.isUnused) {
        colorClass = "tree-unused";
      }

      tree += `<div class="${colorClass}">    ${connector}${icon} ${file.name}</div>`;
    });
  });

  return tree;
};
